"0","# Temporal smooths across years using wrap_plots()"
"0",""
"0",""
"0","library(patchwork)"
"0","library(scales)"
"0","library(stringr)"
"0",""
"0","# Colour scheme"
"0","year_colours <- c("
"0","  ""2012"" = ""#D55E00"",  # burnt orange"
"0","  ""2013"" = ""#0072B2"",  # deep blue"
"0","  ""2014"" = ""#009E73""   # teal green"
"0",")"
"0",""
"0","# Covariate labels"
"0","label_cleaner <- function(x) {"
"0","  x %>% str_replace_all(""_"", "" "") %>% str_to_title()"
"0","}"
"0",""
"0","library(gratia)"
"0",""
"0","# Extract smooth estimates from the GAM"
"0","smooth_df <- smooth_estimates(gam_model_SP)"
"0",""
"0","# Filter out spatial and illiteracy terms"
"0","filtered_df <- smooth_df %>%"
"0","  filter("
"0","    !str_detect(.smooth, ""Illiteracy""),"
"0","    !str_detect(.smooth, ""lon"")"
"0","  ) %>%"
"0","  mutate("
"0","    covariate = str_extract(.smooth, ""(?<=s\\().+?(?=\\))""),   # extract covariate name"
"0","    year = str_extract(.smooth, ""\\d{4}"")                      # extract year from label"
"0","  )"
"0",""
"0",""
"0","# Plot list, Using a for loop to so we cal do them all at once."
"0","plot_list <- list()"
"0","unique_covs <- unique(filtered_df$covariate)"
"0",""
"0","for (cov in unique_covs) {"
"0","  df_sub <- filtered_df %>% filter(covariate == cov)"
"0","  "
"0","  p <- ggplot(df_sub, aes_string(x = cov, y = "".estimate"", colour = ""year"")) +"
"0","    geom_line(linewidth = 1) +"
"0","    geom_hline(yintercept = 0, linetype = ""dashed"", colour = ""grey40"", linewidth = 0.4) +"
"0","    scale_colour_manual(values = year_colours) +"
"0","    labs("
"0","      x = label_cleaner(cov),"
"0","      y = NULL"
"0","    ) +"
"0","    theme_bw(base_size = 12) +"
"0","    theme("
"0","      plot.title = element_blank(),"
"0","      axis.title.x = element_text(size = 11),"
"0","      axis.text = element_text(size = 10),"
"0","      panel.grid.major = element_line(size = 0.2),"
"0","      panel.grid.minor = element_blank(),"
"0","      legend.position = ""none"""
"0","    )"
"0","  "
"0","  plot_list[[cov]] <- p"
"0","}"
"0",""
"0",""
"0","# Plot Layout - Shared Legend"
"0","combined_plot <- wrap_plots(plot_list, ncol = 2) +"
"0","  plot_layout(guides = ""collect"") &"
"0","  theme("
"0","    legend.position = ""bottom"","
"0","    legend.title = element_blank(),"
"0","    legend.text = element_text(size = 11),"
"0","    plot.margin = margin(10, 10, 10, 10)"
"0","  )"
"0",""
"0","# Adding Figure Title"
"0"," combined_plot +"
"0","  plot_annotation("
"0","    title = ""Temporal Variation in Socio-Economic Covariate Effects on TB Risk"","
"0","    theme = theme("
"0","      plot.title = element_text(size = 16, face = ""bold"", hjust = 0.5)"
"0","    )"
"0","  )"
