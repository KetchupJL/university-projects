"0","library(mgcv)"
"0","set.seed(123)"
"0","# Fit the Negative Binomial GAM with population offset. Base Model"
"0","TBdata$Year <- factor(TBdata$Year)"
"0","TBdata$Region <- factor(TBdata$Region)"
"0",""
"0","TBdata$logPop <- log(TBdata$Population)"
"0",""
"0","# Ensure categorical variables are factors"
"0","TBdata$fYear <- factor(TBdata$Year)"
"0",""
"0",""
"0","# First GAM model"
"0","gam_model_initial <- gam(TB ~ "
"0","                   s(Indigenous, bs = ""tp"", k=10) +"
"0","                   s(Illiteracy, bs = ""tp"", k=10) +"
"0","                   s(Urbanisation, bs = ""tp"", k=10) +"
"0","                   s(Density, bs = ""tp"", k=10) +"
"0","                   s(Poverty, bs = ""cr"", k=5) +"
"0","                   s(Unemployment, bs = ""cr"", k=5) +"
"0","                   s(Poor_Sanitation, k = 10, bs = ""cr"") +"
"0","                   s(Timeliness, bs = ""tp"", k=10) +"
"0","                   te(lon, lat, by = Year, bs = c(""tp"", ""cr""), k = c(20, 20, 5)) +"
"0","                   offset(logPop),"
"0","                 data = TBdata, "
"0","                 family = nb(link = ""log""), "
"0","                 method = ""REML"")"
"0",""
"0","# Used a mix of ""cr"" and ""tp"" splines. CR on the covariates with mostly linear trends, as this smooth function is better on them."
"0",""
"0","par(mfrow = c(2,2))"
"0","gam.check(gam_model_initial)"
"1","
Method:"
"1"," "
"1","REML"
"1"," "
"1","  Optimizer:"
"1"," "
"1","outer"
"1"," "
"1","newton"
"1","
"
"1",""
"1","full convergence"
"1",""
"1"," after "
"1",""
"1","7"
"1",""
"1"," iteration"
"1","s."
"1","
Gradient range ["
"1",""
"1","-0.001630894"
"1",""
"1",","
"1",""
"1","0.0004803748"
"1",""
"1","]"
"1","
(score "
"1",""
"1","7130.615"
"1",""
"1"," & scale "
"1",""
"1","1"
"1",""
"1",")."
"1","
Hessian positive definite, "
"1","eigenvalue range ["
"1",""
"1","0.0008076696"
"1",""
"1",","
"1",""
"1","529.8071"
"1",""
"1","].
"
"1","Model rank = "
"1"," "
"1","135"
"1"," "
"1","/"
"1"," "
"1","135"
"1"," "
"1","
"
"1","
"
"1","Basis dimension (k) checking results. Low p-value (k-index<1) may
"
"1","indicate that k is too low, especially if edf is close to k'.

"
"1","                    "
"1","    k'"
"1","   edf"
"1"," k-index"
"1"," p-value"
"1","    "
"1","
s(Indigenous)       "
"1","  9.00"
"1","  1.01"
"1","    0.51"
"1","  <2e-16"
"1"," ***"
"1","
s(Illiteracy)       "
"1","  9.00"
"1","  2.87"
"1","    0.51"
"1","  <2e-16"
"1"," ***"
"1","
s(Urbanisation)     "
"1","  9.00"
"1","  4.29"
"1","    0.52"
"1","  <2e-16"
"1"," ***"
"1","
s(Density)          "
"1","  9.00"
"1","  3.69"
"1","    0.52"
"1","  <2e-16"
"1"," ***"
"1","
s(Poverty)          "
"1","  4.00"
"1","  1.00"
"1","    0.52"
"1","  <2e-16"
"1"," ***"
"1","
s(Unemployment)     "
"1","  4.00"
"1","  3.34"
"1","    0.52"
"1","  <2e-16"
"1"," ***"
"1","
s(Poor_Sanitation)  "
"1","  9.00"
"1","  5.33"
"1","    0.51"
"1","  <2e-16"
"1"," ***"
"1","
s(Timeliness)       "
"1","  9.00"
"1","  4.59"
"1","    0.58"
"1","  <2e-16"
"1"," ***"
"1","
te(lon,lat):Year2012"
"1"," 24.00"
"1"," 12.86"
"1","    0.48"
"1","  <2e-16"
"1"," ***"
"1","
te(lon,lat):Year2013"
"1"," 24.00"
"1"," 14.06"
"1","    0.47"
"1","  <2e-16"
"1"," ***"
"1","
te(lon,lat):Year2014"
"1"," 24.00"
"1"," 13.43"
"1","    0.48"
"1","  <2e-16"
"1"," ***"
"1","
"
"1","---
Signif. codes:  "
"1",""
"1","0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1"
"1","
"
